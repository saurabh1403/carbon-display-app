<?xml version="1.0" encoding="utf-8"?>
<s:BorderContainer xmlns:fx="http://ns.adobe.com/mxml/2009"
				   xmlns:s="library://ns.adobe.com/flex/spark"
				   xmlns:mx="library://ns.adobe.com/flex/mx"
				   xmlns:components="com.Tutorial.MCQModule.view.components.*"
				   width="100%" height="100%" backgroundColor="#2F3030"
				   contentBackgroundColor="#706C6C"
				   xmlns:rs="imports.PageFlip.com.rubenswieringa.book.*"
				   borderVisible="true" borderWeight="1"
				   creationComplete="bordercontainer1_creationCompleteHandler(event)" 
				   xmlns:ResultPageRelated="com.Tutorial.MCQModule.view.components.ResultPageRelated.*"
				   creationPolicy="all">
	
	<fx:Style source="com/Tutorial/MCQModule/Styles/MCQStyles.css">
		
	</fx:Style>
	
	<fx:Script>
		<![CDATA[
			import com.Tutorial.MCQModule.Controller.DataProcessor;
			import com.Tutorial.MCQModule.Controller.MCQConstants;
			
			import com.Tutorial.MCQModule.Events.TestSelectionEvent;
			
			import imports.PageFlip.com.rubenswieringa.book.*;
			import imports.PageFlip.com.rubenswieringa.book.BookEvent;
			
			import com.Tutorial.MCQModule.model.Question;
			import com.Tutorial.MCQModule.model.QuestionsProxy;
			import com.Tutorial.MCQModule.model.TestResultData;
			
			import mx.charts.ChartItem;
			import mx.charts.HitData;
			import mx.charts.chartClasses.ChartBase;
			import mx.charts.chartClasses.Series;
			import mx.charts.series.PieSeries;
			import mx.charts.series.items.ColumnSeriesItem;
			import mx.collections.ArrayCollection;
			import mx.collections.IViewCursor;
			import mx.controls.Alert;
			import mx.events.FlexEvent;
			import mx.events.IndexChangedEvent;
			import mx.utils.object_proxy;
			
			import spark.components.Application;
			
			public var pieChartData:ChartBase  = new ChartBase();
			
			[Bindable]
			public var testResult:TestResultData ;
			
			[Bindable]
			private var isFirstPageBeingShown:Boolean = true;               //this shows whether first page is being shown or not. and it will control the prev button visibility
			
			[Bindable]
			private var isLastPageBeingShown:Boolean = false;
			
			private const total_pages:int = 8;                      //set this equal to the number of pages
			
			private const quoteDict:Dictionary = new Dictionary(true);
			
			public function resetView():void
			{
				isFirstPageBeingShown = true;           //this shows whether first page is being shown or not. and it will control the prev button visibility
				
				isLastPageBeingShown = false;
				
			}
			
			public function disposeView():void
			{
				
			}
			
			//TODO: currently it takes data from proxy. Make it take a parameter as test result data object
			public function processData(quesProxy:QuestionsProxy):void
			{
				testResult = quesProxy.testResult;
				
				//TODO: update it later when the page is turned
				marksPieChartPage.updateView(quesProxy);
				markStatPage.updateView(quesProxy);
				
				timeStatPage.updateView(quesProxy);
				timeBarGraphPage.updateView(quesProxy);
				
				processView();
				resultBook.gotoPage(FirstBookPage, false);
			}
			
			protected function processView():void
			{
				if(parseInt(testResult.percentObtained) > 80)
				{
					frontPage.performanceLabel.text = "Your Performance is Good.";
					//					frontPage.performanceBar.setStyle("backgroundColor", 0x47B56F);
					frontPage.finalPerformanceColor = 0x47B56F;
					frontPage.performanceLevel = 1;
				}
					
				else if(parseInt(testResult.percentObtained) > 50)
				{
					frontPage.performanceLabel.text = "You have average performance.";
					//					frontPage.performanceBar.setStyle("backgroundColor", 0xdad853);
					frontPage.finalPerformanceColor = 0xF5A525;
					frontPage.performanceLevel = 2;
				}
					
				else
				{
					frontPage.performanceLabel.text = "You have low performance.";
					//					frontPage.performanceBar.setStyle("backgroundColor", 0xd66556);
					frontPage.finalPerformanceColor = 0xFA3719;
					frontPage.performanceLevel = 3;
				}
				
			}
			
			protected function retakeButtonClicked(event:Event):void
			{
				var quesProxy:QuestionsProxy = DataProcessor.instance.quesProxy;
				
				var newEvent:TestSelectionEvent = new TestSelectionEvent(MCQConstants.testViewStartEventName);
				newEvent.testFolderPath = quesProxy.testBaseFolderPath;
				newEvent.testXmlName = quesProxy.testXmlName;
				dispatchEvent(newEvent);
			}
			
			protected function reviewButtonClicked(event:Event):void
			{
				var newEvent:Event = new Event(MCQConstants.testReviewEventName);
				dispatchEvent(newEvent);
			}
			
			protected function quitButtonClicked(event:Event):void
			{
				var newEvent:Event = new Event(MCQConstants.testQuitEventName);
				dispatchEvent(newEvent);
			}
			
			protected function nextPageButtonClicked(event:Event):void
			{
				resultBook.nextPage();
			}
			
			protected function prevPageButtonClicked(event:Event):void
			{
				resultBook.prevPage();
			}
			
			protected function resultBookStatsuChanged(event:BookEvent):void
			{
				if(resultBook.currentPage == -1)
				{
					prevPageButton.visible = false;
				}
					
				else if(resultBook.currentPage == total_pages - 1)
				{
					nextPageButton.visible = false;
				}
					
				else
				{
					nextPageButton.visible = true;
					prevPageButton.visible = true;
				}
				
				if(resultBook.currentPage == 3)
				{
					//                                      Alert.show("now page is turned", "haha");       
				}
			}
			
			protected function bordercontainer1_creationCompleteHandler(event:FlexEvent):void
			{
				resultBook.addEventListener(BookEvent.PAGE_TURNED, resultBookStatsuChanged);
			}
			
			protected function showPerformanceImproveTip(event:Event):void
			{
				//TODO
				Alert.show("Work Hard and concentrate more to improve the score", "Golden Tips"); 
			}
			
			protected function showTimeStatHelpLink(event:Event):void
			{
				//TODO:
			}
			
		]]>
	</fx:Script>
	
	<fx:Style>
		@namespace s "library://ns.adobe.com/flex/spark";
		@namespace mx "library://ns.adobe.com/flex/mx";
		@namespace components "view.components.*";
		
		.resultGridStyle
		{
			percentWidth:100;
			height:60;
		}               
		
	</fx:Style>
	
	<s:states>
		<s:State name="quesStat"/>
	</s:states>
	
	<fx:Declarations>
		<!-- Place non-visual elements (e.g., services, value objects) here -->
		<mx:SolidColor id="sc2" color="#68E31B" alpha=".8"/>
		<s:SolidColorStroke id="s1" color="#79B553" weight="2"/>
	</fx:Declarations>
	
	<ResultPageRelated:ResultSuggestionPage width="{MCQConstants.appWidth * 0.4}"
											height="{MCQConstants.appHeight * 0.8}"
											horizontalCenter="{MCQConstants.appWidth * (-0.2)}"
											top="40"
											visible="false"	includeInLayout="false"
											/>
	
	<s:HGroup top="45" width="100%"
			  height="{MCQConstants.appHeight * 0.8}" verticalAlign="bottom">
		<s:Spacer width="15" />
		
		<s:Button id="prevPageButton" visible="false" left="10" width="50" height="50"
				  label="Prev" click="prevPageButtonClicked(event)" skinClass="com.Tutorial.MCQModule.skins.TransparentRoundButtonSkin"
				  icon="@Embed('assets/assetsMCQModule/arrowPrev.png')"
				  verticalCenter="{MCQConstants.appHeight * 0.4 - 8}"
				  useHandCursor="true"
				  buttonMode="true"
				  mouseChildren="false"
				  />
		
		<s:Spacer width="5%"/>
		<s:BorderContainer width="{MCQConstants.appWidth * 0.8}" height="100%" backgroundAlpha="0"
						   backgroundColor="#F1CA98" borderAlpha="0.0" borderColor="#817F7F"
						   visible="false"
						   includeInLayout="false"
						   borderWeight="4" contentBackgroundAlpha="0.0" horizontalCenter="0">
			
			<s:backgroundFill>
				<s:LinearGradient rotation="90">
					<s:GradientEntry color="#F2EF16"/>
					<s:GradientEntry color="#F58E20"/>
				</s:LinearGradient>
			</s:backgroundFill>
			
		</s:BorderContainer>

			<rs:Book id="resultBook" visible="true"  easing="0.7" flipOnClick="true"
					 sideFlip="true"
					 autoFlipDuration="600"
					 creationPolicy="auto"
					 width="{MCQConstants.appWidth * 0.8 - 8}"
					 height="{MCQConstants.appHeight * 0.8 - 8}"
					 horizontalCenter="0"
					 verticalCenter="0"
					 >
				
				<rs:Page hard="true" id="FirstBookPage">
					<ResultPageRelated:ResultFrontPage 
						id="frontPage" 
						width="100%" height="100%"
						nextPageClicked="nextPageButtonClicked(event)"
						performanceImproveLinkClicked="{resultBook.gotoPage(performanceImprove)}"
						/>                      
				</rs:Page>
				
				<rs:Page>
					<ResultPageRelated:marksStatsPage id="markStatPage"/>
				</rs:Page>
				
				<rs:Page>
					<ResultPageRelated:ResultPieChart id="marksPieChartPage"/>
				</rs:Page>
				
				<rs:Page>
					<ResultPageRelated:timeStatsPage 
						id="timeStatPage"
						timeStatsHelpLinkClicked="{resultBook.gotoPage(performanceAnalyze)}"
						/>
				</rs:Page>
				
				<rs:Page>
					<ResultPageRelated:ResultBarGraph id="timeBarGraphPage"/>
				</rs:Page>
				
				<rs:Page id="performanceImprove">
					<ResultPageRelated:performanceImprovementPage
						/>
				</rs:Page>
				
				<rs:Page id="performanceAnalyze">
					<ResultPageRelated:performanceAnalyzePage />
				</rs:Page>
				
				<rs:Page>
					<ResultPageRelated:ResultEndPage />
				</rs:Page>
				
			</rs:Book>
			
		<s:Spacer width="5%"/>
		<s:Button id="nextPageButton" visible="true" right="10" width="50" height="50"
				  label="Next" click="nextPageButtonClicked(event)" 
				  icon="@Embed('assets/assetsMCQModule/arrowNext.png')"
				  skinClass="com.Tutorial.MCQModule.skins.TransparentRoundButtonSkin"
				  verticalCenter="{MCQConstants.appHeight * 0.4 - 8}"
				  useHandCursor="true"
				  buttonMode="true"
				  mouseChildren="false"
				  />
		
		<s:Spacer width="15"/>
	</s:HGroup>
	
	<s:HGroup bottom="15" height="5%" maxHeight="40" minHeight="30" width="100%">

		<s:Spacer width="25%"/>
		<s:Button bottom="20" width="15%" height="100%" label="Retake Test" chromeColor="#A5A694"
				  click="retakeButtonClicked(event)" color="#000000" fontSize="16"
				  skinClass="com.Tutorial.MCQModule.skins.RetakeButtonSkin"
				  />

		<s:Spacer width="25%" />
		<s:Button bottom="20" width="15%" height="100%" label="Review Test"
				  chromeColor="#A5A694" click="reviewButtonClicked(event)" color="#000000" fontSize="16"
				  skinClass="com.Tutorial.MCQModule.skins.ReviewButtonSkin"
				  />
		<s:Spacer width="20%"/>

	</s:HGroup>
	
	<s:Button id="quitbutton" right="10" top="10" width="45" height="45" label="Quit"
			  skinClass="com.Tutorial.MCQModule.skins.TransparentRoundButtonSkin"
			  icon="@Embed('assets/assetsMCQModule/exit.png')"
			  click="quitButtonClicked(event)"
			  useHandCursor="true"
			  buttonMode="true"
			  mouseChildren="false"
			  />
	
	<s:Label left="10" top="5" color="#C0BEB9" fontStyle="italic" fontWeight="bold"
			 text="{MCQConstants.copyrightInfo}"/>
	
</s:BorderContainer>